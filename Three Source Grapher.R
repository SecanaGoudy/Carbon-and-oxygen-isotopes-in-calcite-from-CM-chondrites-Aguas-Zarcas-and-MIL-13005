#Clear Workspace----
remove(list=ls(all=TRUE))

#Generate Feeders----
ic1 <- c(32.5,32.5)
ic2 <- c(112.4,112.4)
ic3 <- c(3.0,3.0)
io1 <- c(57.8,57.8)
io2 <- c(23.8,23.8)
io3 <- c(2.2,2.2)
kc1 <- c(0.567,0.567)
kc2 <- c(0.587,0.587)
kc3 <- c(0.714,0.714)
ko1 <- c(0.363,0.363)
ko2 <- c(0.413,0.413)
ko3 <- c(0.269,0.269)
#Note on the above: This is is the endmembers of the current iteration of the ranges. This script is meant to have these be altered manually with each run, shrink the ranges based on the results of the preceding iteration.

#Processing----
new_ko1 <- c((ko1[1]+((ko1[2]-ko1[1])*0.25)),(ko1[2]-((ko1[2]-ko1[1])*0.25)))
new_ko2 <- c((ko2[1]+((ko2[2]-ko2[1])*0.25)),(ko2[2]-((ko2[2]-ko2[1])*0.25)))
new_ko3 <- c((ko3[1]+((ko3[2]-ko3[1])*0.25)),(ko3[2]-((ko3[2]-ko3[1])*0.25)))
new_kc1 <- c((kc1[1]+((kc1[2]-kc1[1])*0.25)),(kc1[2]-((kc1[2]-kc1[1])*0.25)))
new_kc2 <- c((kc2[1]+((kc2[2]-kc2[1])*0.25)),(kc2[2]-((kc2[2]-kc2[1])*0.25)))
new_kc3 <- c((kc3[1]+((kc3[2]-kc3[1])*0.25)),(kc3[2]-((kc3[2]-kc3[1])*0.25)))
new_io1 <- c((io1[1]+((io1[2]-io1[1])*0.25)),(io1[2]-((io1[2]-io1[1])*0.25)))
new_io2 <- c((io2[1]+((io2[2]-io2[1])*0.25)),(io2[2]-((io2[2]-io2[1])*0.25)))
new_io3 <- c((io3[1]+((io3[2]-io3[1])*0.25)),(io3[2]-((io3[2]-io3[1])*0.25)))
new_ic1 <- c((ic1[1]+((ic1[2]-ic1[1])*0.25)),(ic1[2]-((ic1[2]-ic1[1])*0.25)))
new_ic2 <- c((ic2[1]+((ic2[2]-ic2[1])*0.25)),(ic2[2]-((ic2[2]-ic2[1])*0.25)))
new_ic3 <- c((ic3[1]+((ic3[2]-ic3[1])*0.25)),(ic3[2]-((ic3[2]-ic3[1])*0.25)))
#Note on the above: These lines are generating new endmember values to be selected from for use in the next iteration of this script.
ko1 <- rep(x=ko1,times=(2^11),each=(2^0))
ko2 <- rep(x=ko2,times=(2^10),each=(2^1))
ko3 <- rep(x=ko3,times=(2^9),each=(2^2))
kc1 <- rep(x=kc1,times=(2^8),each=(2^3))
kc2 <- rep(x=kc2,times=(2^7),each=(2^4))
kc3 <- rep(x=kc3,times=(2^6),each=(2^5))
io1 <- rep(x=io1,times=(2^5),each=(2^6))
io2 <- rep(x=io2,times=(2^4),each=(2^7))
io3 <- rep(x=io3,times=(2^3),each=(2^8))
ic1 <- rep(x=ic1,times=(2^2),each=(2^9))
ic2 <- rep(x=ic2,times=(2^1),each=(2^10))
ic3 <- rep(x=ic3,times=(2^0),each=(2^11))
#Note on the above section: This section is creating every cobination of the range endmembers that is possible.

#Anchor Points----
anchor <- ((54.3-(((((ko1*kc2*ic2)-(ko2*kc1*ic1))*44.4)+((ko2*kc1*io2*ic1)-(ko1*kc2*io1*ic2)))/((((ko1*kc2)-(ko2*kc1))*44.4)+((ko2*kc1*io2)-(ko1*kc2*io1)))))^2)
anchor <- anchor+((88.1-(((((ko1*kc2*ic2)-(ko2*kc1*ic1))*36.3)+((ko2*kc1*io2*ic1)-(ko1*kc2*io1*ic2)))/((((ko1*kc2)-(ko2*kc1))*36.3)+((ko2*kc1*io2)-(ko1*kc2*io1)))))^2)
anchor <- anchor+((43.4-(((((ko1*kc2*ic2)-(ko2*kc1*ic1))*49.4)+((ko2*kc1*io2*ic1)-(ko1*kc2*io1*ic2)))/((((ko1*kc2)-(ko2*kc1))*49.4)+((ko2*kc1*io2)-(ko1*kc2*io1)))))^2)
anchor <- anchor+((78.8-(((((ko1*kc2*ic2)-(ko2*kc1*ic1))*39.3)+((ko2*kc1*io2*ic1)-(ko1*kc2*io1*ic2)))/((((ko1*kc2)-(ko2*kc1))*39.3)+((ko2*kc1*io2)-(ko1*kc2*io1)))))^2)
anchor <- anchor+((9.4-(((((ko1*kc3*ic3)-(ko3*kc1*ic1))*15.5)+((ko3*kc1*io3*ic1)-(ko1*kc3*io1*ic3)))/((((ko1*kc3)-(ko3*kc1))*15.5)+((ko3*kc1*io3)-(ko1*kc3*io1)))))^2)
anchor <- anchor+((16.5-(((((ko1*kc3*ic3)-(ko3*kc1*ic1))*24.6)+((ko3*kc1*io3*ic1)-(ko1*kc3*io1*ic3)))/((((ko1*kc3)-(ko3*kc1))*24.6)+((ko3*kc1*io3)-(ko1*kc3*io1)))))^2)
anchor <- anchor+((18.8-(((((ko1*kc3*ic3)-(ko3*kc1*ic1))*28.5)+((ko3*kc1*io3*ic1)-(ko1*kc3*io1*ic3)))/((((ko1*kc3)-(ko3*kc1))*28.5)+((ko3*kc1*io3)-(ko1*kc3*io1)))))^2)
anchor <- anchor+((21.0-(((((ko1*kc3*ic3)-(ko3*kc1*ic1))*34.8)+((ko3*kc1*io3*ic1)-(ko1*kc3*io1*ic3)))/((((ko1*kc3)-(ko3*kc1))*34.8)+((ko3*kc1*io3)-(ko1*kc3*io1)))))^2)
anchor <- anchor+((86.4-(((((ko2*kc3*ic3)-(ko3*kc2*ic2))*19.7)+((ko3*kc2*io3*ic2)-(ko2*kc3*io2*ic3)))/((((ko2*kc3)-(ko3*kc2))*19.7)+((ko3*kc2*io3)-(ko2*kc3*io2)))))^2)
anchor <- anchor+((64.6-(((((ko2*kc3*ic3)-(ko3*kc2*ic2))*17.0)+((ko3*kc2*io3*ic2)-(ko2*kc3*io2*ic3)))/((((ko2*kc3)-(ko3*kc2))*17.0)+((ko3*kc2*io3)-(ko2*kc3*io2)))))^2)
anchor <- anchor+((56.8-(((((ko2*kc3*ic3)-(ko3*kc2*ic2))*16.8)+((ko3*kc2*io3*ic2)-(ko2*kc3*io2*ic3)))/((((ko2*kc3)-(ko3*kc2))*16.8)+((ko3*kc2*io3)-(ko2*kc3*io2)))))^2)
anchor <- anchor+((27.1-(((((ko2*kc3*ic3)-(ko3*kc2*ic2))*12.2)+((ko3*kc2*io3*ic2)-(ko2*kc3*io2*ic3)))/((((ko2*kc3)-(ko3*kc2))*12.2)+((ko3*kc2*io3)-(ko2*kc3*io2)))))^2)
#Note on the above: These lines are calculating goodness of fit for different combinations of range endmembers.
new_ko1_ref <- median(ko1[anchor==min(anchor)])
new_ko2_ref <- median(ko2[anchor==min(anchor)])
new_ko3_ref <- median(ko3[anchor==min(anchor)])
new_kc1_ref <- median(kc1[anchor==min(anchor)])
new_kc2_ref <- median(kc2[anchor==min(anchor)])
new_kc3_ref <- median(kc3[anchor==min(anchor)])
new_io1_ref <- median(io1[anchor==min(anchor)])
new_io2_ref <- median(io2[anchor==min(anchor)])
new_io3_ref <- median(io3[anchor==min(anchor)])
new_ic1_ref <- median(ic1[anchor==min(anchor)])
new_ic2_ref <- median(ic2[anchor==min(anchor)])
new_ic3_ref <- median(ic3[anchor==min(anchor)])
#Note on the above: These lines are selecting the endmember for each range consistent with the specific combination of range input values that had the best goodness of fit.
remove(anchor,ic1,ic2,ic3,io1,io2,io3,kc1,kc2,kc3,ko1,ko2,ko3)
